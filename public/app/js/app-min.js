var myApp=angular.module("hrmPayroll",["ngRoute","ngCookies"]);myApp.config(["$routeProvider","$locationProvider",function(e,a){function t(e){return"app/templates/"+e}e.when("/",{templateUrl:t("admin/login.html"),reloadOnSearch:!0,controller:"userController",authenticated:!1}),e.when("/dashboard",{templateUrl:t("dashboard/dashboard.html"),reloadOnSearch:!0,controller:"userController",authenticated:!0}),e.when("/employee/add",{templateUrl:t("employees/create.html"),reloadOnSearch:!0,controller:"employeeAddController",authenticated:!0}),e.when("/employees/list",{templateUrl:t("employees/list.html"),reloadOnSearch:!0,controller:"employeeAddController",authenticated:!0}),e.when("/branches/list",{templateUrl:t("branches/list.html"),reloadOnSearch:!0,controller:"branchListController",authenticated:!0}),e.when("/branch/add",{templateUrl:t("branches/create.html"),reloadOnSearch:!0,controller:"branchAddController",authenticated:!0}),e.when("/branch/edit/:branchID",{templateUrl:t("branches/edit.html"),reloadOnSearch:!0,controller:"branchEditController",authenticated:!0}),e.otherwise("/"),a.html5Mode(!0).hashPrefix("!")}]),myApp.run(["$rootScope","$location","userModel",function(e,a,t){e.$on("$routeChangeStart",function(e,n,r){n.$$route.authenticated&&(t.getAuthStatus()||a.path("/")),"/"==n.$$route.originalPath&&t.getAuthStatus()&&a.path(r.$$route.originalPath)})}]),myApp.controller("branchAddController",["$scope","$timeout","$location","userModel","branchModel",function(e,a,t,n,r){e.successStatus=!1,e.errorStatus=!1,angular.extend(e,{addNewBranch:function(){if(e.branchAdd.$valid){var n={name:e.branch.branch_name,address1:e.branch.address1,address2:e.branch.address2,city:e.branch.city,phone:e.branch.phone,fax:e.branch.fax};r.doCreateBranch(n).success(function(n){angular.element(".success-message-container").html(n.message),e.successStatus=!0,e.errorStatus=!1,a(function(){t.path("/branches/list")},3e3)}).error(function(a,t,n){angular.element(".error-message-container").html(a.message),e.errorStatus=!0,e.successStatus=!1})}}})}]),myApp.controller("branchEditController",["$scope","$timeout","$location","$routeParams","userModel","branchModel",function(e,a,t,n,r,o){e.successStatus=!1,e.errorStatus=!1,e.branch={};var s=$.trim(n.branchID);a(function(){e.getBranchData(s)},100),e.getBranchData=function(a){""!=a&&o.getBranchById(a).success(function(a){e.branch.branch_name=a.data.name,e.branch.address1=a.data.address1,e.branch.address2=a.data.address2,e.branch.city=a.data.city,e.branch.phone=a.data.phone,e.branch.fax=a.data.fax})},e.updateBranch=function(){if(e.branchEdit.$valid){var n={name:e.branch.branch_name,address1:e.branch.address1,address2:e.branch.address2,city:e.branch.city,phone:e.branch.phone,fax:e.branch.fax};o.doUpdateBranch(n,s).success(function(n){angular.element(".success-message-container").html(n.message),e.successStatus=!0,e.errorStatus=!1,a(function(){t.path("/branches/list")},3e3)}).error(function(a,t,n){angular.element(".error-message-container").html(a.message),e.errorStatus=!0,e.successStatus=!1})}}}]),myApp.controller("branchListController",["$scope","$timeout","$routeParams","userModel","branchModel",function(e,a,t,n,r){e.branchList={},e.branchTablePages={};var o=$.trim(t.page);a(function(){e.getBranches(o)},100),e.getBranches=function(a){r.getBranches(a).success(function(a){e.branchList=a.data.data;a.data.last_page;e.branchTablePages=[1,2,3,4,5,6]})}}]),myApp.controller("employeeAddController",["$scope","$timeout","userModel","employeeModel",function(e,a,t,n){e.successStatus=!1,a(function(){$("#empWizard").bootstrapWizard({tabClass:"nav nav-pills"}),$(".select_drop").select2(),$("#joined_date").datepicker({autoclose:!0}),$("#birthday").datepicker({autoclose:!0}),$("#confirmation_date").datepicker({autoclose:!0})},100),e.addNewEmployee=function(){if(e.employeeAdd.$valid){var t={epf:e.employee.username,full_name:e.employee.full_name,first_name:e.employee.first_name,middle_name:e.employee.middle_name,last_name:e.employee.last_name,gender:e.employee.gender,marital_status:e.employee.marital_status,nic_num:e.employee.nic_num,driving_license:e.employee.driving_license,birthday:e.employee.birthday,address1:e.employee.address1,address2:e.employee.address2,city:e.employee.city,postal_code:e.employee.postal_code,home_phone:e.employee.home_phone,mobile_phone:e.employee.mobile_phone,work_phone:e.employee.work_phone,private_email:e.employee.private_email,section:e.employee.section,pay_grade:e.employee.pay_grade,joined_date:e.employee.joined_date,confirmation_date:e.employee.confirmation_date,salary:e.employee.salary,trans_allow:e.employee.trans_allow,br_allowance:e.employee.br_allowance,special_allow:e.employee.special_allow,att_allow:e.employee.att_allow};n.addEmployee(t).success(function(t){angular.element(".success-message-container").html(t.message),e.successStatus=!0,e.errorStatus=!1,a(function(){$location.path("/branches/list")},3e3)}).error(function(a,t,n){angular.element(".error-message-container").html(a.message),e.errorStatus=!0,e.successStatus=!1})}}}]),myApp.controller("employeeListController",["$scope","$timeout","userModel",function(e,a,t){a(function(){$("#example1").DataTable()},1e3),angular.extend(e,{})}]),myApp.controller("mainController",["$scope","userModel",function(e,a){e.isError=!1,e.errors={},e.loggedIn=!1,e.$on("userLogged",function(){a.getAuthStatus()?e.loggedIn=!0:e.loggedIn=!1}),a.getAuthStatus()&&(e.loggedIn=!0),angular.extend(e,{})}]),myApp.controller("userController",["$scope","$location","$rootScope","userModel",function(e,a,t,n){angular.extend(e,{doLogin:function(){var r={username:e.login.username,password:e.login.password};n.doLogin(r).then(function(e){t.$broadcast("userLogged"),a.path("/dashboard")})},doLogout:function(){n.doLogout(),window.location.href="/"}})}]),myApp.factory("branchModel",["$http","$cookies","userModel",function(e,a,t){var n={};return n.doCreateBranch=function(a){return e({headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-auth-token":t.getToken()},url:baseURL+"api/branches",method:"POST",data:{name:a.name,address1:a.address1,address2:a.address2,city:a.city,phone:a.phone,fax:a.fax}})},n.getBranches=function(a){return e({headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-auth-token":t.getToken()},url:baseURL+"api/branches?page="+a,method:"GET"})},n.getBranchById=function(a){return e({headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-auth-token":t.getToken()},url:baseURL+"api/branches/"+a+"/edit",method:"GET"})},n.doUpdateBranch=function(a,n){return e({headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-auth-token":t.getToken()},url:baseURL+"api/branches/"+n,method:"PUT",data:{name:a.name,address1:a.address1,address2:a.address2,city:a.city,phone:a.phone,fax:a.fax}})},n}]),myApp.factory("employeeModel",["$http","$cookies","userModel",function(e,a,t){var n={};return n.addEmployee=function(a){return e({header:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","x-auth-token":"4cae192431b176809178575aed83b95dccd5c3d9"},url:baseURL+"api/employees",method:"POST",data:{epf:a.username,full_name:a.full_name,first_name:a.first_name,middle_name:a.middle_name,last_name:a.last_name,gender:a.gender,marital_status:a.marital_status,nic_num:a.nic_num,driving_license:a.driving_license,birthday:a.birthday,address1:a.address1,address2:a.address2,city:a.city,postal_code:a.postal_code,home_phone:a.home_phone,mobile_phone:a.mobile_phone,work_phone:a.work_phone,private_email:a.private_email,section:a.section,pay_grade:a.pay_grade,joined_date:a.joined_date,confirmation_date:a.confirmation_date,salary:a.salary,trans_allow:a.trans_allow,br_allowance:a.br_allowance,special_allow:a.special_allow,att_allow:a.att_allow}})},n}]),myApp.factory("userModel",["$http","$cookies",function(e,a){var t={};return t.doLogin=function(t){return e({headers:{"Content-Type":"application/json"},url:baseURL+"api/login",method:"POST",data:{username:t.username,password:t.password}}).success(function(e){a.put("auth",JSON.stringify(e))}).error(function(e,a,t){return e})},t.getAuthStatus=function(){var e=a.get("auth");return!!e},t.doLogout=function(){a.remove("auth")},t.getToken=function(){var e=this.getLoggedUser();return e=JSON.parse(e).data,e&&e.token?e.token:""},t.getLoggedUser=function(){return a.get("auth")},t}]),myApp.factory("validationModel",[function(){return{email:function(e){var a=/^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return a.test(e)},numbers:function(e){var a=/^[0-9]+$/;return a.test(e)},alphaNumeric:function(e){var a=/^[a-zA-Z0-9]+$/;return a.test(e)},searchText:function(e){var a=/^[A-Za-z\d\s]+$/;return a.test(e)},empty:function(e){return"undefined"==typeof e||null==e||"null"==e||""==e}}}]);